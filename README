                              Bare Bones

--------------------------------------------------------------------------------
Introduction
--------------------------------------------------------------------------------

This source provides a complete port of the C Bare Bones tutorial from
http://wiki.osdev.org. I copied and modified the linker script from the D port
as the original didn't work for me and also did the same with the startup code
from the original C port.

The full documentation and build instructions for this project can be found at:

  http://wiki.osdev.org/Ada_Bare_bones

Once you have cloned this repository, you need to set up the links to the
RTS inside rts/boards/i386/adainclude/ to point to those in rts/src/ as follows:

for f in "ada.ads" "a-unccon.ads" "a-uncdea.ads" "gnat.ads" "g-souinf.ads" "interfac.ads" "s-atacco.adb" "s-atacco.ads" "s-maccod.ads" "s-stoele.adb" "s-stoele.ads"
do
ln -s `pwd`/rts/src/$f `pwd`/rts/boards/i386/adainclude/$f
done

--------------------------------------------------------------------------------
Prerequisites
--------------------------------------------------------------------------------
To test using make QEMU, you will need GRUB 2 installed for the grub-mkrescue
(GRUB 2 should be installed if you're on a modern distribution) command. This
command also uses xorriso - which I had to install separately.

Under Debian:

$ sudo apt-get install qemu xorriso

--------------------------------------------------------------------------------
Bugs
--------------------------------------------------------------------------------

The inability to declare local exceptions has been filed:
  http://gcc.gnu.org/bugzilla/show_bug.cgi?id=53684

  This has been refuted by Eric Botcazou where he states that we need to
  provide a custom Ada.Exceptions package, so I have created one, as can be
  see:

  https://github.com/Lucretia/bare_bones/blob/master/rts/src/a-except.ads
  https://github.com/Lucretia/bare_bones/blob/master/rts/src/a-except.adb

  This works as long as you don't try to catch any exceptions locally, at which
  point practically everything gives a warning:

  bare_bones.adb:25:17: warning: pragma Restrictions (No_Exception_Propagation) in effect
  bare_bones.adb:25:17: warning: "Constraint_Error" may call Last_Chance_Handler
  ...
  bare_bones.adb:150:20: warning: "Constraint_Error" may call Last_Chance_Handler
  bare_bones.adb:153:04: warning: pragma Restrictions (No_Exception_Propagation) in effect
  bare_bones.adb:153:04: warning: Last_Chance_Handler will be called on exception
  bare_bones.adb:162:04: warning: pragma Restrictions (No_Exception_Propagation) in effect
  bare_bones.adb:162:04: warning: this handler can never be entered, and has been removed
  bare_bones.adb:162:09: violation of restriction "No_Exception_Propagation" at ../gnat.adc:10
  gnatmake: "/home/laguest/src/mine/bare_bones/src/bare_bones.adb" compilation error
  make: *** [disk/boot/bare_bones] Error 4

  So the net effect of not bothering and only using the language defined
  exceptions for bare metal programming.

--------------------------------------------------------------------------------
Licence
--------------------------------------------------------------------------------

The code here is released under the BSD licence, I have not put in licence
indicators for the linker script or the startup code, as I didn't write those.
